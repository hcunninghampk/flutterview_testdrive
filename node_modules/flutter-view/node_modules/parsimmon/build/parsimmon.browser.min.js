(function(t,n){if(typeof define==="function"&&define.amd){define([],n)}else if(typeof module==="object"&&module.exports){module.exports=n()}else{t.Parsimmon=n()}})(this,function(){"use strict";var t={};function n(t){if(!(this instanceof n))return new n(t);this._=t}t.Parser=n;var r=n.prototype;function e(t,n){return{status:true,index:t,value:n,furthest:-1,expected:[]}}function u(t,n){return{status:false,index:-1,value:null,furthest:t,expected:[n]}}function i(t,n){if(!n)return t;if(t.furthest>n.furthest)return t;var r=t.furthest===n.furthest?t.expected.concat(n.expected):n.expected;return{status:t.status,index:t.index,value:t.value,furthest:n.furthest,expected:r}}function a(t){if(!(t instanceof n))throw new Error("not a parser: "+t)}function f(t){if(typeof t!=="number")throw new Error("not a number: "+t)}function o(t){if(!(t instanceof RegExp))throw new Error("not a regex: "+t)}function c(t){if(typeof t!=="function")throw new Error("not a function: "+t)}function s(t){if(typeof t!=="string")throw new Error("not a string: "+t)}function l(t){if(t.length===1)return t[0];return"one of "+t.join(", ")}function v(t,n){var r=n.index;var e=r.offset;if(e===t.length)return", got the end of the stream";var u=e>0?"'...":"'";var i=t.length-e>12?"...'":"'";return" at line "+r.line+" column "+r.column+", got "+u+t.slice(e,e+12)+i}var h=t.formatError=function(t,n){return"expected "+l(n.expected)+v(t,n)};r.parse=function(t){if(typeof t!=="string"){throw new Error(".parse must be called with a string as its argument")}var n=this.skip(P)._(t,0);return n.status?{status:true,value:n.value}:{status:false,index:C(t,n.furthest),expected:n.expected}};var p=t.seq=function(){var t=[].slice.call(arguments);var r=t.length;for(var u=0;u<r;u+=1){a(t[u])}return n(function(n,u){var a;var f=new Array(r);for(var o=0;o<r;o+=1){a=i(t[o]._(n,u),a);if(!a.status)return a;f[o]=a.value;u=a.index}return i(e(u,f),a)})};var d=t.seqMap=function(){var t=[].slice.call(arguments);var n=t.pop();return p.apply(null,t).map(function(t){return n.apply(null,t)})};var g=t.custom=function(t){return n(t(e,u))};var x=t.alt=function(){var t=[].slice.call(arguments);var r=t.length;if(r===0)return O("zero alternates");for(var e=0;e<r;e+=1){a(t[e])}return n(function(n,r){var e;for(var u=0;u<t.length;u+=1){e=i(t[u]._(n,r),e);if(e.status)return e}return e})};var m=t.sepBy=function(n,r){return y(n,r).or(t.of([]))};var y=t.sepBy1=function(t,n){a(t);a(n);var r=n.then(t).many();return t.chain(function(t){return r.map(function(n){return[t].concat(n)})})};r.or=function(t){return x(this,t)};r.then=function(t){if(typeof t==="function"){throw new Error("chaining features of .then are no longer supported, use .chain instead")}a(t);return p(this,t).map(function(t){return t[1]})};r.many=function(){var t=this;return n(function(n,r){var u=[];var a;var f;for(;;){a=i(t._(n,r),a);if(a.status){r=a.index;u.push(a.value)}else{return i(e(r,u),a)}}})};r.times=function(t,r){if(arguments.length<2)r=t;var u=this;f(t);f(r);return n(function(n,a){var f=[];var o=a;var c;var s;for(var l=0;l<t;l+=1){c=u._(n,a);s=i(c,s);if(c.status){a=c.index;f.push(c.value)}else return s}for(;l<r;l+=1){c=u._(n,a);s=i(c,s);if(c.status){a=c.index;f.push(c.value)}else break}return i(e(a,f),s)})};r.result=function(t){return this.map(function(n){return t})};r.atMost=function(t){return this.times(0,t)};r.atLeast=function(t){var n=this;return d(this.times(t),this.many(),function(t,n){return t.concat(n)})};r.map=function(t){c(t);var r=this;return n(function(n,u){var a=r._(n,u);if(!a.status)return a;return i(e(a.index,t(a.value)),a)})};r.skip=function(t){return p(this,t).map(function(t){return t[0]})};r.mark=function(){return d(D,this,D,function(t,n,r){return{start:t,value:n,end:r}})};r.desc=function(t){var r=this;return n(function(n,e){var u=r._(n,e);if(!u.status)u.expected=[t];return u})};var w=t.string=function(t){var r=t.length;var i="'"+t+"'";s(t);return n(function(n,a){var f=n.slice(a,a+r);if(f===t){return e(a+r,f)}else{return u(a,i)}})};var _=t.regex=function(t,r){o(t);if(r)f(r);var i=RegExp("^(?:"+t.source+")",(""+t).slice((""+t).lastIndexOf("/")+1));var a=""+t;if(r==null)r=0;return n(function(t,n){var f=i.exec(t.slice(n));if(f){var o=f[0];var c=f[r];if(c!=null)return e(n+o.length,c)}return u(n,a)})};var E=t.succeed=function(t){return n(function(n,r){return e(r,t)})};var O=t.fail=function(t){return n(function(n,r){return u(r,t)})};var b=t.letter=_(/[a-z]/i).desc("a letter");var k=t.letters=_(/[a-z]*/i);var z=t.digit=_(/[0-9]/).desc("a digit");var A=t.digits=_(/[0-9]*/);var j=t.whitespace=_(/\s+/).desc("whitespace");var q=t.optWhitespace=_(/\s*/);var B=t.any=n(function(t,n){if(n>=t.length)return u(n,"any character");return e(n+1,t.charAt(n))});var M=t.all=n(function(t,n){return e(t.length,t.slice(n))});var P=t.eof=n(function(t,n){if(n<t.length)return u(n,"EOF");return e(n,null)});var R=t.test=function(t){c(t);return n(function(n,r){var i=n.charAt(r);if(r<n.length&&t(i)){return e(r+1,i)}else{return u(r,"a character matching "+t)}})};var W=t.oneOf=function(t){return R(function(n){return t.indexOf(n)>=0})};var F=t.noneOf=function(t){return R(function(n){return t.indexOf(n)<0})};var I=t.takeWhile=function(t){c(t);return n(function(n,r){var u=r;while(u<n.length&&t(n.charAt(u)))u+=1;return e(u,n.slice(r,u))})};var L=t.lazy=function(t,r){if(arguments.length<2){r=t;t=undefined}var e=n(function(t,n){e._=r()._;return e._(t,n)});if(t)e=e.desc(t);return e};var C=function(t,n){var r=t.slice(0,n).split("\n");var e=r.length;var u=r[r.length-1].length+1;return{offset:n,line:e,column:u}};var D=t.index=n(function(t,n){return e(n,C(t,n))});r.concat=r.or;r.empty=O("empty");r.of=n.of=t.of=E;r.ap=function(t){return d(this,t,function(t,n){return t(n)})};r.chain=function(t){var r=this;return n(function(n,e){var u=r._(n,e);if(!u.status)return u;var a=t(u.value);return i(a._(n,u.index),u)})};return t});
